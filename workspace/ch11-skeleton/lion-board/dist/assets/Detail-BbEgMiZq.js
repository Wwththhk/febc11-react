import{a as x,b as p,j as e,L as u,c as f,H as N}from"./index-B8grBGTx.js";import{u as b,P as n}from"./index-SYigVxrp.js";import{u as h,a as v,I as w}from"./index.esm-DSuZsbif.js";import{u as g}from"./userStore-BYH4lJr9.js";import{u as q}from"./useQuery-DjLx6EtE.js";j.propTypes={item:n.shape({_id:n.number.isRequired,user:n.shape({_id:n.number,name:n.string,image:n.object}).isRequired,content:n.string.isRequired,createdAt:n.string.isRequired}).isRequired};function j({item:s}){const{user:r}=g(),a=x(),i=b(),{_id:t}=p(),o=h({mutationFn:m=>i.delete(`/posts/${m}/replies/${s._id}`),onSuccess:()=>{a.invalidateQueries({queryKey:["posts",t]})}});return e.jsxs("div",{className:"shadow-md rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.user.image&&e.jsx("img",{className:"w-8 mr-2 rounded-full",src:`https://11.fesp.shop${s.user.image.path}`,alt:`${s.user.name} 프로필 이미지`}),e.jsx(u,{to:"",className:"text-orange-400",children:s.user.name||"익명"}),e.jsx("time",{className:"ml-auto text-gray-500",dateTime:`${s.createdAt}`,children:s.createdAt})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("pre",{className:"whitespace-pre-wrap text-sm",children:s.content}),(r==null?void 0:r._id)===s.user._id&&e.jsx("button",{type:"button",onClick:()=>o.mutate(t),className:"bg-red-500 py-1 px-2 text-sm text-white font-semibold ml-2 hover:bg-amber-400 rounded",children:"삭제"})]})]})}function $(){const{register:s,handleSubmit:r,formState:{errors:a},reset:i}=v(),t=b(),{_id:o}=p(),m=x(),d=h({mutationFn:l=>t.post(`/posts/${o}/replies`,l),onSuccess:()=>{m.invalidateQueries({queryKey:["posts",o]}),i()},onError:l=>{console.error(l)}});return e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[e.jsx("h4",{className:"mb-4",children:"새로운 댓글을 추가하세요."}),e.jsxs("form",{onSubmit:r(d.mutate),children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("textarea",{rows:"3",cols:"40",className:"block p-2 w-full text-sm border rounded-lg border-gray-300 bg-gray-50 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white",placeholder:"내용을 입력하세요.",...s("content",{required:"내용은 필수입니다."})}),e.jsx(w,{target:a.content})]}),e.jsx("button",{type:"submit",className:"bg-orange-500 py-1 px-4 text-sm text-white font-semibold ml-2 hover:bg-amber-400 rounded",children:"댓글 등록"})]})]})}y.propTypes={data:n.array};function y({data:s=[]}){const r=s.map(a=>e.jsx(j,{item:a},a._id));return e.jsxs("section",{className:"mb-8",children:[e.jsxs("h4",{className:"mt-8 mb-4 ml-2",children:["댓글 ",r.length,"개"]}),r,e.jsx($,{})]})}function I(){const{user:s}=g(),r=b(),{type:a,_id:i}=p(),{data:t}=q({queryKey:["posts",i],queryFn:()=>r.get(`/posts/${i}`),select:c=>c.data,staleTime:1e3*10}),o=f(),m=x(),d=h({mutationFn:c=>r.delete(`/posts/${c}`),onSuccess:()=>{alert("게시물이 삭제되었습니다."),m.invalidateQueries({queryKey:["posts",a]}),o(`/${a}`)}}),l=c=>{c.preventDefault(),d.mutate(i)};return t?e.jsxs(e.Fragment,{children:[e.jsxs(N,{children:[e.jsxs("title",{children:[t.item.title," - 멋사컴"]}),e.jsx("meta",{property:"og:title",content:t.item.title}),e.jsx("meta",{property:"og:description",content:t.item.content})]}),e.jsxs("main",{className:"container mx-auto mt-4 px-4",children:[e.jsx("section",{className:"mb-8 p-4",children:e.jsxs("form",{onSubmit:l,children:[e.jsxs("div",{className:"font-semibold text-xl",children:["제목 : ",t.item.title]}),e.jsxs("div",{className:"text-right text-gray-400",children:["작성자 : ",t.item.user.name]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{children:e.jsx("pre",{className:"font-roboto w-full p-2 whitespace-pre-wrap",children:t.item.content})}),e.jsx("hr",{})]}),e.jsxs("div",{className:"flex justify-end my-4",children:[e.jsx(u,{to:`/${a}`,className:"bg-orange-500 py-1 px-4 text-base text-white font-semibold ml-2 hover:bg-amber-400 rounded",children:"목록"}),(s==null?void 0:s._id)===t.item.user._id&&e.jsxs(e.Fragment,{children:[e.jsx(u,{to:`/${a}/${i}/edit`,className:"bg-gray-900 py-1 px-4 text-base text-white font-semibold ml-2 hover:bg-amber-400 rounded",children:"수정"}),e.jsx("button",{type:"submit",className:"bg-red-500 py-1 px-4 text-base text-white font-semibold ml-2 hover:bg-amber-400 rounded",children:"삭제"})]})]})]})}),e.jsx(y,{data:t.item.replies})]})]}):e.jsx("div",{children:"로딩중..."})}export{I as default};
